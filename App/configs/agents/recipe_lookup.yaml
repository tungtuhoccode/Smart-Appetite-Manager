log:
  stdout_log_level: INFO

!include ../shared_config.yaml

apps:
  - name: recipe-lookup_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app

    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE, sam/}
      supports_streaming: true
      agent_name: "RecipeLookup"
      display_name: "Recipe Lookup (Online)"
      model: *general_model

      instruction: |
        You are a recipe lookup assistant.

        Your job:
        1) Ask for the user's available ingredients.
        2) Use the `get_top_3_meals` tool to find the top 3 recipes that best match the user's ingredients. The search results will include a summary of used and missing ingredients for each recipe.
        3) Present the top 3 meal options to the user, including the used and missing ingredient counts.
        4) When the user chooses an option, present the detailed lists of "Used Ingredients" and "Missing Ingredients" that you received from the `get_top_3_meals` call for that specific recipe.
        5) Then, use the `get_meal_details` tool for the selected recipe to fetch and display the full step-by-step cooking instructions.

      Tool use: |
        - When the user provides ingredients, call `get_top_3_meals` with the `ingredients` parameter. For example: `get_top_3_meals(ingredients='chicken,rice')`.
        - The `get_top_3_meals` tool will return all the information you need about used and missing ingredients. Do not call `get_meal_details` to get this information.
        - After the user selects a meal, use its ID to get the cooking instructions: `get_meal_details(meal_id=...)`.

      tools:
        - tool_type: python
          component_base_path: "src"
          component_module: "recipe_agent.mealdb_tools"
          function_name: "get_top_3_meals"

        - tool_type: python
          component_base_path: "src"
          component_module: "recipe_agent.mealdb_tools"
          function_name: "search_meals"

        - tool_type: python
          component_base_path: "src"
          component_module: "recipe_agent.mealdb_tools"
          function_name: "get_meal_details"

        - tool_type: python
          component_base_path: "src"
          component_module: "recipe_agent.mealdb_tools"
          function_name: "get_random_meal"

      session_service:
        type: ${PERSISTENCE_TYPE, memory}
        database_url: ${CUSTOM_AGENT_DATABASE_URL,}

      artifact_service: *default_artifact_service

      agent_card:
        description: >
          Looks up recipes online using Spoonacular, then formats ingredients and
          step-by-step cooking directions. Use this agent when the user asks for a
          recipe, meal ideas, or "what can I cook with X".
        defaultInputModes: ["text"]
        defaultOutputModes: ["text"]
        skills:
          - id: "recipe_search"
            name: "Search recipes"
            description: "Find recipes by ingredient."
          - id: "recipe_details"
            name: "Get recipe details"
            description: "Fetch full ingredients and instructions for a selected recipe."

      agent_card_publishing:
        interval_seconds: 10

      agent_discovery:
        enabled: true

      inter_agent_communication:
        allow_list: ["OrchestratorAgent"]
        request_timeout_seconds: 60
